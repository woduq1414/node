function getColor(e){var t=0,a=e.length;if(e.length===0){return t}for(i=0;i<a;i++){charC=e.charCodeAt(i);t=(t<<5)-t+charC;t=t&t}t=t*t;t=t%16777216;t=t.toString(16);return t}function chatAppend(e,t){if(e=="noticePrimary"){$("#chatting").append("<div class='alert alert-primary' style='text-align:center'>"+t+"</div>")}else if(e=="chat"){$("#chatting").append("<div class='alert alert-light' style='text-align:left'>"+t+"</div>")}else if(e=="noticeDanger"){$("#chatting").append("<div class='alert alert-danger' style='text-align:center'>"+t+"</div>")}$("#chatting").scrollTop($("#chatting")[0].scrollHeight)}var socket=io({transports:["websocket"],upgrade:false});var currentRoom;var info;var users;var currentName=$("#currentName").text().trim();$(document).ready(function(){$("#exitRoom").css("visibility","hidden");socket.emit("initName",currentName);$("#roomContainer").css("height",parseFloat($("#leftContainer").css("height"))-parseFloat($("#exitRoom").css("height"))-parseFloat($("#upperRoomContainer").css("height"))+"px")});function namePopover(e){if(info[e].members[0]==getMyName()&&!info[e].isPlaying){$(".chatName").each(function(){$temp=$(this);$(this).popover({placement:"bottom",trigger:"click",html:true,sanitize:false,title:`<span>${$(this).attr("data-sname")}</span>   <a class="close"><i style="font-size:20px" class="fas fa-times"></i></a>`,content:`\n                      <button data="${$(this).attr("data-sid")}" class="btn btn-primary mandate" type="button" data-toggle="popover" data-placement="bottom" data-html="true" >방장 위임</button>\n                      <button data="${$(this).attr("data-sid")}" class="btn btn-danger kick" type="button" data-toggle="popover" data-placement="bottom" data-html="true" >나가 ㅋ</button>\n                `}).on("shown.bs.popover",function(e){var t="#"+$(e.target).attr("aria-describedby");console.log(t);var a=$(t);a.find(".close").click(function(){$(".chatName").popover("hide")});a.find(".mandate").click(function(){$(".chatName").popover("hide")});a.find(".kick").click(function(){$(".chatName").popover("hide")})})})}else{$(".chatName").popover("dispose")}}function getMyName(){return currentName}function chatSend(){var e=$("#currentName").text().trim();var t=$("#chatArea").val();socket.emit("sendChat",currentRoom,e,t);$("#chatArea").val("")}if(!currentRoom){$("#chatContainer").css("visibility","hidden")}else{$("#chatContainer").css("visibility","visible")}$(document).on("click","#startGame",function(){socket.emit("enterGame",currentRoom)});$(document).on("click","#chatRoomManage",function(){Swal.fire({title:"Room Manage",html:`\n  <div class="input-group mb-3">\n    <div class="input-group-prepend">\n      <span class="input-group-text" id="basic-addon1">방 이름</span>\n    </div>\n    <input type="text" id="changeRoomNameArea" class="form-control" placeholder="방 이름" aria-label="방 이름" aria-describedby="basic-addon1" value="${currentRoom}">\n  </div>\n  <div class="input-group mb-3">\n    <div class="input-group-prepend">\n      <span class="input-group-text" id="basic-addon1">최대 인원</span>\n    </div>\n    <input type="text" id="changeRoomLimitArea" class="form-control" placeholder="최대 인원" aria-label="최대 인원" aria-describedby="basic-addon1" value="${info[currentRoom].limit}">\n  </div>\n  <div class="input-group mb-3">\n    <div class="input-group-prepend">\n      <div class="input-group-text">\n        비밀번호\n      </div>\n      <div class="input-group-text">\n        <input id="changePasswordCheck" type="checkbox" aria-label="Checkbox for following text input" ${info[currentRoom].password?"checked":""}>\n      </div>\n    </div>\n    <input id="changePasswordArea" type="password" class="form-control" aria-label="Text input with checkbox" ${info[currentRoom].password?"":"disabled"}>\n  </div>\n  `,showCancelButton:true,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Apply",inputAttributes:{autocapitalize:"off"},preConfirm:()=>{let e=$("#changePasswordCheck").is(":checked");if(e){password=$("#changePasswordArea").val();socket.emit("changePassword",currentRoom,password)}else{password="";socket.emit("changePassword",currentRoom,password)}let t=info[currentRoom].limit;let a=$("#changeRoomLimitArea").val();if(t!=a){socket.emit("changeRoomLimit",currentRoom,t,a)}t=currentRoom;a=$("#changeRoomNameArea").val();if(t!=a){socket.emit("changeRoomName",t,a);currentRoom=a}}})});socket.on("refreshUser",function(e){users=e;console.log(users)});socket.on("changePassword",function(e,t){if(t==0){chatAppend("noticePrimary",`${e}의 비밀번호가 해제됨 ㅋ`)}else{chatAppend("noticePrimary",`${e}의 비밀번호가 변경됨 ㅋ`)}});socket.on("changeRoomLimit",function(e,t){chatAppend("noticePrimary",`방의 최대 인원이 ${e}에서 ${t}로 변경됨 ㅋ`)});socket.on("changeRoomLimitErr",function(){Swal.fire({icon:"error",title:"저런",text:"현재 인원보다 최대 인원이 작으면 안됨ㅋ"})});socket.on("changeRoomName",function(e,t){currentRoom=t;chatAppend("noticePrimary",`방의 이름이 ${e}에서 ${t}로 변경됨 ㅋ`)});socket.on("a",function(e){console.log(e)});$(document).on("click","#chatSend",function(){chatSend()});$("#chatArea").keyup(function(e){if(e.keyCode==13)chatSend()});$("#chatting").css("height",parseFloat($("#chatContainer").css("height"))-parseFloat($("#roomMasterArea").css("height"))-parseFloat($("#chatSendArea").css("height"))+"px");$(window).resize(function(){$("#chatting").css("height",parseFloat($("#chatContainer").css("height"))-parseFloat($("#roomMasterArea").css("height"))-parseFloat($("#chatSendArea").css("height"))+"px")});$(window).resize(function(){$("#roomContainer").css("height",parseFloat($("#leftContainer").css("height"))-parseFloat($("#exitRoom").css("height"))-parseFloat($("#upperRoomContainer").css("height"))+"px")});$(document).on("click","#passwordCheck",function(){if($(this).is(":checked")){$("#passwordArea").prop("disabled",false)}else{$("#passwordArea").prop("disabled",true)}});$(document).on("click","#changePasswordCheck",function(){if($(this).is(":checked")){$("#changePasswordArea").prop("disabled",false)}else{$("#changePasswordArea").prop("disabled",true)}});$(document).on("click","#exitRoom",function(){socket.emit("leaveRoom",currentRoom)});$(document).on("click",".logout",function(){location.href="/logout"});$(document).on("click","#makeRoom",function(){Swal.fire({title:"Room Name",html:`\n  <div class="input-group mb-3">\n    <div class="input-group-prepend">\n      <span class="input-group-text" id="basic-addon1">방 이름</span>\n    </div>\n    <input type="text" id="roomNameArea" class="form-control" placeholder="방 이름" aria-label="방 이름" aria-describedby="basic-addon1">\n  </div>\n  <div class="input-group mb-3">\n    <div class="input-group-prepend">\n      <span class="input-group-text" id="basic-addon1">최대 인원</span>\n    </div>\n    <input type="text" id="roomLimitArea" class="form-control" placeholder="최대 인원" aria-label="최대 인원" aria-describedby="basic-addon1" value="12">\n  </div>\n  <div class="input-group mb-3">\n    <div class="input-group-prepend">\n      <div class="input-group-text">\n        비밀번호\n      </div>\n      <div class="input-group-text">\n        <input id="passwordCheck" type="checkbox" aria-label="Checkbox for following text input">\n      </div>\n    </div>\n    <input id="passwordArea" type="password" class="form-control" aria-label="Text input with checkbox" disabled>\n  </div>\n  `,showCancelButton:true,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Apply",inputAttributes:{autocapitalize:"off"},showLoaderOnConfirm:true,preConfirm:()=>{let e;let t=$("#roomNameArea").val();let a=$("#passwordCheck").is(":checked");if(a){e=$("#passwordArea").val()}else{e=""}let o=$("#roomLimitArea").val();console.log(t,a,e);if(getMyName()){socket.emit("makeRoom",t,e,o);socket.emit("joinRoom",t,getMyName())}}})});socket.on("newRoomMaster",function(e,t,a){chatAppend("noticePrimary",`<span class='chatName' data-sname='${t}' data-sid='${a}' style='font-weight:1000;color:#${getColor(t)}'>${t}</span>님이 ${e}의 방장이 됨 ㅋ`);if(t===getMyName()){$("#roomMasterArea").html(`<div id="chatRoomManage" class="btn btn-secondary" style="margin-right:0px ; width:80%;height:40px">방 관리</div><div id="startGame" class="btn btn-danger" style="width:20%;height:40px">게임 시작</div>`);$("#roomMasterArea").css("height","40px");$("#chatting").css("height",parseFloat($("#chatContainer").css("height"))-parseFloat($("#roomMasterArea").css("height"))-parseFloat($("#chatSendArea").css("height"))+"px")}else{$("#roomMasterArea").html(`<div id="chatRoomManage" class="alert alert-secondary" style="width:100%;height:0px">방 관리</div>`);$("#roomMasterArea").css("height","0px");$("#chatting").css("height",parseFloat($("#chatContainer").css("height"))-parseFloat($("#roomMasterArea").css("height"))-parseFloat($("#chatSendArea").css("height"))+"px")}namePopover(e)});socket.on("receiveChat",function(e,t,a,o){if(info[t].members[0]==a&&!info[t].isPlaying){chatAppend("chat",`<span data-toggle="popover" data-placement="bottom"  data-html="true" data-sname='${a}' data-sid='${e}'\n          class='chatName ${e}' style='cursor:pointer;font-weight:1000;color:#${getColor(a)}'><i class='fas fa-crown'></i> ${a}</span> : ${o}`)}else{chatAppend("chat",`<span data-toggle="popover" data-placement="bottom"  data-html="true" data-sname='${a}' data-sid='${e}'\n                              class='chatName ${e}' style='cursor:pointer;font-weight:1000;color:#${getColor(a)}'>${a}</span> : ${o}`)}namePopover(t)});socket.on("noticeChangeName",function(e,t,a){chatAppend("noticePrimary",`<span class="chatName" data-sname='${e}' data-sid='${a}' style='font-weight:1000;color:#${getColor(e)}'>${e}</span>님이 <span class="chatName" data-sname='${t}' data-sid='${a}' style='font-weight:1000;color:#${getColor(t)}'>${t}</span>로 이름 바꿈 ㅋ`);namePopover(currentRoom)});$(document).on("click",".room",function(){var e=$(this).children(".roomName").text();if(e!=currentRoom){if(info[e].password){Swal.fire({title:"Password",text:"비번",input:"password",inputAttributes:{autocapitalize:"off"},showCancelButton:true,confirmButtonText:"Make & Enter",showLoaderOnConfirm:true,preConfirm:t=>{console.log(e,t);socket.emit("checkPassword",e,t)},allowOutsideClick:()=>!Swal.isLoading()})}else{socket.emit("joinRoom",e,getMyName())}}});socket.on("checkPassword",function(e,t){console.log(t);if(t){socket.emit("joinRoom",e,getMyName())}else{Swal.fire({icon:"error",title:"저런",text:"비밀번호 틀렸음 ㅋ"})}});socket.on("exceedRoomLimit",function(e){Swal.fire({icon:"error",title:"저런",text:"최대 인원 넘어감ㅋ"})});$(document).on("click",".mandate",function(){let e=$(this).attr("data");socket.emit("mandateRoomMaster",currentRoom,e)});$(document).on("click",".kick",function(){let e=$(this).attr("data");socket.emit("kick",currentRoom,e)});socket.on("joinRoom",function(e,t,a,o){if(o){$("#chatting").html("")}chatAppend("noticePrimary",`<span data-sname='${t}' data-sid='${a}' class='chatName ${a}' style='font-weight:1000;color:#${getColor(t)}'>${t}</span>님이 ${e}에 입장함 ㅋ`);currentRoom=e;if(info[e].members[0]===getMyName()){$("#roomMasterArea").html(`<div id="chatRoomManage" class="btn btn-secondary" style="margin-right:0px ; width:80%;height:40px">방 관리</div><div id="startGame" class="btn btn-danger" style="width:20%;height:40px">게임 시작</div>`);$("#roomMasterArea").css("height","40px");$("#chatting").css("height",parseFloat($("#chatContainer").css("height"))-parseFloat($("#roomMasterArea").css("height"))-parseFloat($("#chatSendArea").css("height"))+"px")}else{$("#roomMasterArea").html(`<div class="alert alert-secondary" style="width:100%;height:0px">방 관리</div>`);$("#roomMasterArea").css("height","0px");$("#chatting").css("height",parseFloat($("#chatContainer").css("height"))-parseFloat($("#roomMasterArea").css("height"))-parseFloat($("#chatSendArea").css("height"))+"px")}if(!currentRoom){$("#chatContainer").css("visibility","hidden");$("#exitRoom").css("visibility","hidden")}else{$("#chatContainer").css("visibility","visible");$("#exitRoom").css("visibility","visible")}namePopover(e)});socket.on("leaveRoom",function(e,t,a,o){console.log(e,t,o);chatAppend("noticeDanger",`<span data-sname='${t}' data-sid='${a}' class='chatName ${a}' style='font-weight:1000;color:#${getColor(t)}'>${t}</span>님이 ${e}을 나감 ㅋ`);if(o){currentRoom=undefined}if(!currentRoom){$("#chatContainer").css("visibility","hidden");$("#exitRoom").css("visibility","hidden")}else{$("#chatContainer").css("visibility","visible");$("#exitRoom").css("visibility","visible")}namePopover(e)});socket.on("kickedRoom",function(e,t,a,o){console.log(e,t,o);chatAppend("noticeDanger",`<span data-sname='${t}' data-sid='${a}' class='chatName ${a}' style='font-weight:1000;color:#${getColor(t)}'>${t}</span>님이 강퇴당함 ㅋㅋㅋㅋㅋㅋㅋ`);if(o){currentRoom=undefined;Swal.fire({icon:"error",title:"ㅋㅋㅋㅋㅋㅋㅋ",text:"강퇴 당함 ㅋ"})}if(!currentRoom){$("#chatContainer").css("visibility","hidden");$("#exitRoom").css("visibility","hidden")}else{$("#chatContainer").css("visibility","visible");$("#exitRoom").css("visibility","visible")}namePopover(e)});socket.on("failSetName",function(){alert("이미 있는 이름임ㅋ")});socket.on("successSetName",function(){$("#currentName").text($("#inputName").val());currentName=$("#inputName").val()});$(document).on("click","#setName",function(){var e=$("#currentName").text().trim();var t=$("#inputName").val();socket.emit("changeName",e,t)});socket.on("refreshMain",function(e){info=e;$('[data-toggle="tooltip"]').tooltip("hide");console.log(e);var t="<hr>";for(key in e){if(e[key].isPlaying)continue;let a="";a+=`<span style='color:red !important'>${key}</span><hr class='tooltipHR' style='background-color:red'>`;for(i in e[key]["members"]){if(i==0){a+="<span> <i class='fas fa-crown'></i> "+e[key]["members"][i]+"</span>"}else{a+="<br> <span>"+e[key]["members"][i]+"</span>"}}if(e[key]["members"].includes(getMyName())){t+=`\n            <div class='room alert alert-warning d-flex justify-content-between '\n            data-toggle='tooltip' data-placement='bottom' data-html='true' title="${a}"> \n              <div class='roomName' style="display: block;text-overflow:ellipsis;overflow: hidden;white-space: nowrap;">${key}</div>\n              <div class='roomLimit '>(${e[key].members.length}/${e[key].limit})</div>\n            </div>`}else{t+=`\n            <div class='room alert alert-info d-flex justify-content-between '\n            data-toggle='tooltip' data-placement='bottom' data-html='true' title="${a}"> \n              <div class='roomName' style="display: block;text-overflow:ellipsis;overflow: hidden;white-space: nowrap;">${key}</div>\n              <div class='roomLimit '>(${e[key].members.length}/${e[key].limit})</div>\n            </div>`}t+="<hr>"}$("#roomContainer").html(t);$('[data-toggle="tooltip"]').tooltip();$("#roomContainer").css("height",parseFloat($("#leftContainer").css("height"))-parseFloat($("#exitRoom").css("height"))-parseFloat($("#upperRoomContainer").css("height"))+"px")});socket.on("enterGame",function(){$("#roomMasterArea").html(`<div class="alert alert-secondary" style="width:100%;height:0px">방 관리</div>`);$("#roomMasterArea").css("height","0px");$("#chatting").css("height",parseFloat($("#chatContainer").css("height"))-parseFloat($("#roomMasterArea").css("height"))-parseFloat($("#chatSendArea").css("height"))+"px");$("#chatting").html("");$("#roomMasterArea").html("");$("#leftContainer").html("")});